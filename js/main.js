document.addEventListener("DOMContentLoaded",function(){app.init()});var app={tiempo:null,fechaHora:new Date,actualizar:document.getElementById("actualizar"),accionHoras:void 0,horas:void 0,principalDiv:document.getElementById("principalDiv"),URL_SERVER:"https://calcicolous-moonlig.000webhostapp.com/tiempo/index.php?id=",modal:document.getElementById("modal"),init:function(){if(localStorage.getItem("_tiempo")){app.tiempo=JSON.parse(localStorage.getItem("_tiempo")),app.drawTable();let a=app.fechaHora.getTime();a=(a=a.toString()).slice(0,-3),(a=Number(a))>app.tiempo.hora+7200&&app.realizarLlamada()}else app.realizarLlamada();app.actualizar.addEventListener("click",app.realizarLlamada),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(function(){})},realizarLlamada:function(){app.actualizar.removeEventListener("click",app.realizarLlamada),app.actualizar.classList.add("rotate");let a=new Request(app.URL_SERVER+"18087");fetch(a).then(a=>{200===a.status?a.json().then(a=>{localStorage.setItem("_tiempo",JSON.stringify(a)),app.tiempo=a,app.drawTable()}).catch(function(){app.obtenerDatosGuardados()}):app.obtenerDatosGuardados()}).catch(function(){app.obtenerDatosGuardados()})},obtenerDatosGuardados:function(){app.actualizar.classList.remove("rotate"),app.encenderBoton(),app.modal.classList.remove("hide"),document.getElementById("closeModal").addEventListener("click",()=>{app.modal.classList.add("hide"),document.getElementById("closeModal").removeEventListener("click",()=>{})}),localStorage.getItem("_tiempo")&&(app.tiempo=JSON.parse(localStorage.getItem("_tiempo")),app.drawTable())},drawTable:function(){if(app.actualizar.addEventListener("click",app.realizarLlamada),app.actualizar.classList.remove("rotate"),null!=app.tiempo.dia&&app.tiempo.dia.length>0){let a=app.drawData();app.principalDiv.innerHTML=a,app.accionHoras=document.getElementById("accionHoras"),app.horas=document.getElementById("horas"),app.accionHoras.addEventListener("click",app.mostrarHoras)}},drawData:function(a,e){let t="";return void 0!==app.tiempo.semana&&app.tiempo.semana.forEach(function(a){if(app.compareDate(a.fecha)){7===a.estadoCielo.length&&(a.estadoCielo=a.estadoCielo.slice(3,7),a.probPrecipitacion=a.probPrecipitacion.slice(3,7)),3===a.estadoCielo.length&&(a.estadoCielo=a.estadoCielo.slice(1,3),a.probPrecipitacion=a.probPrecipitacion.slice(1,3)),t+=app.formatDate(a.fecha),t+="<div class='card-container'>";let e=!0;a.estadoCielo.forEach(function(i,r){(app.fechaHora.getDate()!==parseInt(a.fecha.substring(8,10))||void 0===i.periodo||void 0!==i.periodo&&parseInt(i.periodo.substring(3,5))>=app.fechaHora.getHours())&&(e?e=!1:t+='<div class="card-separator"></div>',t+=`<div class='card'>\n                        <div class='card-row'>\n                          <div class='temp'>${a.temperatura.maxima}/${a.temperatura.minima}º</div>\n                          <div class='rain'>${a.probPrecipitacion[r].value}%</div>\n                        </div>\n                        <div class='icon'><img alt="${i.descripcion}" \n                          src="./img/weather/${i.value}_g.png"\n                          title="${i.descripcion}"></div>\n                        <div class='time'>${app.formatTime(i)}</div>\n                      </div>`)}),t+="</div>";let i=app.myFindWhere(app.tiempo.dia,{fecha:a.fecha});void 0!==i&&(t+="<div class='separator titleDate'>Por horas</div>",app.compareDate(i.fecha)&&(t+="<div class='horas'>",t+=`<div class='amanecer'>\n                        <span class='orto'>Amanecer: ${i.orto}</span> \n                        <span class='ocaso'>Puesta: ${i.ocaso}</span></div>`,t+="<div class='card-container'>",e=!0,i.estadoCielo.forEach(function(a,r){(app.fechaHora.getDate()!==parseInt(i.fecha.substring(8,10))||app.fechaHora.getDate()===parseInt(i.fecha.substring(8,10))&&app.fechaHora.getHours()<=parseInt(a.periodo))&&(e?e=!1:t+='<div class="card-separator"></div>',t+=`<div class='card'>\n                            <div class='card-row'>\n                              <div class='temp'>${i.temperatura[r].value}º</div>\n                              ${app.formatRain(i.precipitacion[r].value)}\n                            </div>\n                            <div class='icon'><img alt="${a.descripcion}" \n                              src="./img/weather/${a.value}_g.png"\n                              title="${a.descripcion}"></div>\n                            <div class='time'>${a.periodo}:00</div>\n                          </div>`)}),t+="</div>",t+="</div>"))}}),t},mostrarHoras:function(a){app.horas.classList.toggle("hide")},formatRain:function(a){return"Ip"!==a?`<div class='rain'>${a}<span class="min">mm</span></div>`:`<div class='rain'>${a}</div>`},formatTime:function(a){return void 0===a.periodo?"00-24 h":a.periodo.length<=2?a.periodo:a.periodo+" h"},formatDate:function(a){return`<div class='titleDate'>${["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][new Date(parseInt(a.substring(0,4)),parseInt(a.substring(5,7))-1,parseInt(a.substring(8,10))).getDay()]} ${a.substring(8,10)}-${a.substring(5,7)}-${a.substring(0,4)}</div>`},compareDate:function(a){return new Date(parseInt(a.substring(0,4)),parseInt(a.substring(5,7))-1,parseInt(a.substring(8,10)),23,59,59)>=app.fechaHora},myFindWhere:function(a,e){return a.find(a=>Object.keys(e).every(t=>a[t]===e[t]))}};